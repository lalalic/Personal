<#global template=website.defaultTemplate debug="debug." ver="2.0">
<#if init??><@init/></#if>
<#include "/"+template+".html">

<#macro script key src="" version="1">
	<#local version=ver>
	<#if debug!=""><script><#if src!=""><#include src encoding="utf-8" parse=false><#else><#nested></#if></script><#return></#if>
	<#local key="js."+key>
	<#if ((cookie[key][0])!"")==version>
		<script>_c("${key}","script")</script>
		<#return>
	<#else>
		<script id="${key}"><#if src!=""><#include src encoding="utf-8" parse=false><#else><#nested></#if></script>
		<script>_cf("${key}","${version}")</script>
	</#if>
</#macro>

<#macro link key href="" version="1" rel="">
	<#local version=ver>
	<#local key="css."+key>
	<#if debug=="" && ((cookie[key][0])!"")==version>
		<script>_c("${key}","style")</script>
		<#return>
	<#else>
		<style id="${key}"><#if href!=""><#include href encoding="utf-8" parse=false><#else><#nested></#if></style>
		<script>_cf("${key}","${version}")</script>
	</#if>
</#macro>

<#macro _tmpl key version="1">
	<#local version=ver>
	<#local key="html."+key>
	<#if debug=="" && ((cookie[key][0])!"")==version>
		<#return>
	<#else>
		<script type="text/tmpl" id="${key}"><#nested></script>
		<script>_cf("${key}","${version}")</script>
	</#if>
</#macro>

<#macro _data key mode=1>
	<#if mode==1>
		<script>$t("html.${key}",(function(data){data={};<#nested>;return data})())</script>
	<#elseif mode==2>
		<script>$t("html.${key}",(function(data){data={};<#nested>;return data})(),function(a){document.addEventListener('DOMContentLoaded',function(){document.body.insertAdjacentHTML("beforeend",a)})})</script>
	<#else>
		
	</#if>
</#macro>

<#macro checkbox title name options values=[]>
	<span class="select checkbox"><span>${title}</span><#list options as o><input class="unvisible" type="checkbox" name="${name}" value="${o.ID}"><span>${o.name}</span></#list></span>
</#macro>

<#macro radio title name options value>
	<span class="select radio"><span>${title}</span><#list options as o><input class="unvisible" type="radio" name="${name}" value="${o.ID}"><span>${o.name}</span></#list></span>
</#macro>


<#macro editor name content="" placeholder="Input content here" style="">
	<div id="editor" data-control="carousel">
		<div><#if content==""><div><span/></div><#else>${content}</#if></div>
	</div><textarea placeholder="${placeholder}"></textarea><input type="hidden" name="${name}">
	<@uploader/>
</#macro>

<#macro uploader>
	<@_tmpl "uploader">
	<div id="uploader" class="unvisible">
	<form method="post" enctype="multipart/form-data" target="uploader_frame">
		<input type="file" name="file" multiple="true" 
		onchange="if(this.value){this.form.action=(_a.href=x('GET','/media/want2upload/media/return').responseText,_a).pathname;this.form.submit()}">
		<a id="_a">1</a>
	</form>
	<iframe id="uploader_frame" src="about:blank" 
		onload="var me=this;uploader.start=function(f){$1('#uploader [type=file]').click();me.onload=function(){f(eval(me.contentDocument.body.textContent))}}"></iframe>
	</div>
	</@>
	<@_data "uploader" 2/>
</#macro>

<#macro optionUI options value="" mode="OnlyValue" name="name" prefix="" startIndex=0>
	<#local mode=optionMode(options, mode)>
	<#list options as option>
		<#local v=itemValue(mode, option, startIndex) title=itemTitle(mode, option, name)>
		<option  value="${v}" <#if value?string==v?string>selected="selected"</#if>>${prefix}${title!}</option>
		<#local startIndex=startIndex+1>
    </#list>
</#macro>

<#function itemValue mode option index=0>
	<#switch mode>
		<#case "Model">
			<#return option.ID>
		<#case "ValueName">
			<#return option[0]>
		<#case "OnlyValue">
			<#return option>
		<#case "IndexName">
			<#return index>
	</#switch>
</#function>

<#function itemTitle mode option name="name">
	<#switch mode>
		<#case "Model">
			<#return option[name]>
		<#case "ValueName">
			<#return option[1]>
	</#switch>
	<#return option>
</#function>

<#function optionMode options mode="OnlyValue">
    <#if options?size==0>
        <#return "None">
    <#elseif mode!="OnlyValue">
        <#return mode>
    <#else>
        <#local aoption=options[0]>
        <#if aoption?is_enumerable>
            <#return "ValueName">
        <#elseif aoption?is_hash>
            <#return "Model">
        </#if>
    </#if>
    <#return "OnlyValue">
</#function>

<#macro run macro>
     <#if !(macro??)>
     	
     <#elseif macro?is_string>
     	<@.main[macro]/>
     <#elseif macro?is_hash>
     	<@.main[macro.name] macro.arg/>
     </#if>
</#macro>

<#macro _empty></#macro>
