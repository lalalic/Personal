<#macro init>
    <#import "/com/yy/app/cms/web/slavable.html" as slavable>
    <#include "/com/yy/app/cms/web/slavable.html">
    <@slavable.init/>
    <#assign this=this+{'model':'早教机构','slave':{'model':'点评.体验'}}>
</#macro>

<#macro postFields post>
	<table class="fields">
		<tr><td>商户名称<@required/></td><td>
		     <input name="title" style="width:50%" required value="${post.title!}">
		     <input name="alias" value="${post.alias!}" placeholder="别名"></td></tr>
        <#if (post.parent!0)==0>
        <tr><td>分店名称</td><td><@addableList name="subs" list=post.children! nameField="title"/></td></tr>
        </#if>		
	    <tr rowspan=2><td>地址</td><td><@locationUI model=post /></td></tr>
        <tr><td>联系信息</td><td>
	            <input name="web" placeholder="官网地址" value="${post.web!}"> 
	            <input name="weibo" placeholder="微博地址" value="${post.weibo!}"><br/>
	            <input name="tel" placeholder="电话" value="${post.tel!}">
                <input name="officeTime"  value="${post.officeTime!}" placeholder="营业时间"> 
	        </td></tr>
        
        <tr><td>免费试课</td><td><input type="checkbox" name="freeTry" value="true" <#if post.wifi>checked="checked"</#if> >可以免费试课 
	    <tr><td>课程类别</td><td>
	        <@checkboxUI name="classTypes" options=['亲子课','无脖圈亲子游泳','绘本导读','情绪管理','音乐器乐','舞蹈','美术手工','运动体育','创意积木','棋类','科技','英文','戏剧表演','父母育儿类','其它'] values=post.classTypes!/></td></tr>
	    <tr><td>适合月龄</td><td>
            <@checkboxUI name="ageTypes" options=['0-12个月 ','12-24个月','24-36个月','36-48个月','48个月以上'] values=post.classTypes!/></td></tr>
        <tr><td>老师</td><td><@addableList name="instructors" list=post.instructors!/></td></tr>
	    <tr><td>其他信息</td><td>
	        <input name="bus" value="${post.bus!}" placeholder="公交信息"> 
	        
	        <input type="checkbox" name="wifi" value="true" <#if post.wifi>checked="checked"</#if> >免费无线 
	        <input type="checkbox" name="cardPay" value="true" <#if post.cardPay>checked="checked"</#if> >刷卡 
	        <input type="checkbox" name="feedingRoom" value="true" <#if post.feedingRoom>checked="checked"</#if> >哺乳室  
	        <input type="checkbox" name="disableFacility" value="true" <#if post.disableFacility>checked="checked"</#if> >无障碍设施 
	    </td></tr> 
	    <tr><td>介绍</td><td>
	    	<@editor name="content" content=post.content> title="介绍"</@editor></td></tr>
	</table>
</#macro>

<#macro show1Fields post>
    <#assign sidebarMacros=sidebarMacros+['showSubs']>
	<div>
		<table>
		    <#local classTypes=post.classTypes!>
		    <#if (classTypes?size>0)>
		        <tr><td>课程</td><td>
		            <#list classTypes as ct> ${ct} </#list><br/>
		            <#list ageTypes as ct> ${ct} </#list><br/>
		            </td></tr>
		    </#if>
		    
		    <#if post.tel!?has_content || post.web!?has_content || post.weibo!?has_content>
		        <tr><td>联系</td><td>
		            <#if post.tel?has_content>电话:${post.tel!}</#if>
		            <#if post.officeTime!?has_content> 工作时间:${post.officeTime!}</#if>
		            <#if post.web?has_content> 网址:<a href="${post.web!}">${post.web!}</a></#if> 
		            <#if post.weibo?has_content> 微博:<a href="${post.weibo!}">${post.weibo!}</a></#if>
		        </td></tr>
		    </#if>
		    
		    <#if post.city!?has_content || post.area!?has_content || post.address!?has_content>
		        <tr><td>地址</td><td>${post.cityName!} ${post.areaName!} ${post.address!} - ${post.landmarkers!}</td></tr>
		    </#if>
		    
		    <tr><td>其他信息</td><td>
		        <#if post.bus!?has_content>公交信息:${post.bus!}</#if>
		        <#if post.wifi>有<#else>无</#if>免费无线
		        <#if !post.cardPay>不</#if>能刷卡
		        <#if post.feedingRoom>有<#else>无</#if>哺乳室
		        <#if !post.disableFacility>没</#if>有无障碍设施
		    </td></tr>
		</table>
	   	<p class="postcontent">${post.content}</p>
	   	<@authorInfo post/>
   	</div>
   	<@slavePost post/>
</#macro>

<#macro slavePostFields parent>
	<input type="hidden" name="parent" value="${parent.ID}">   
	<table class="fields">
	    <tr><td>题目<@required/></td><td><input style="width:80%" name="title" required></td></tr>
	    <#local children=user.children>
	    <tr><td><div class="span-2">孩子信息</div></td><td>
	        <#switch children?size>
	        <#case 0>
	            <input name="nick" placeholder="昵称">, 生日<@dateUI name="childbod"/>
	            <#break>
	        <#case 1>
	            ${children[0].nick!}(${children[0].monthes}个月大了)
	            <input type="hidden" name="child" value="${children[0].ID}">
	            <#break>
	        <#default>
	            <select name="child"><@optionUI options=children mode="Model" name="nick"/></select>
	            <#break>
	        </#switch>
	    </td></tr>
	
	    <tr><td>课程</td><td>
	        <#local children=parent.children>
	        <#if children?has_content>
	            <select name="parent">
	                <option value="${parent.ID}">${parent.title}</option>
	                <@optionUI mode="Model" options=children name="title" prefix="--"/>
	            </select><br/>
	        <#else>
	            <input type="hidden" name="parent" value="${parent.ID}">  
	        </#if>     
	        <@addableSelectUI name="classType" options=parent.classTypes! optionMode="OnlyValue">
	            <input name="newClassType" placeholder="课程名称">
	        </@addableSelectUI>
	        <br/>
	        <@dateUI name="coursetime" time=true/> 
	    </td></tr>
	    <tr><td>点评</td>
	        <td style="text-align:center">
	            <div class="clearfix"><@ratingInputUI name="generalRating" title="总体"/></div>
	            <@ratingInputUI name="affinityRating" title="亲和力"/>
	            <@ratingInputUI name="attractiveRating" title="是否能吸引宝宝注意力"/>
	            <@ratingInputUI name="expressiveRating" title="表现力和感染力"/>
	            <@ratingInputUI name="bridingRating" title="各环节衔接性"/>
	            <@ratingInputUI name="chineseRating" title="普通话发音"/>
	            <@ratingInputUI name="englishRating" title="英文发音"/>
	        </td></tr>
	    <tr><td>老师</td><td>
	        <@addableSelectUI name="instructor" options=parent.instructors! optionMode="OnlyValue">
	           <input name="newInstructor" placeholder="老师姓名">
	        </@addableSelectUI>
	    </td></tr>
	    <tr><td>心得体会<@required/></td><td>
	    	<@editor name="content">title="心得体会" minlength="300"</@editor></td></tr>
	</table>
</#macro>

<#macro showSubs post>
    <#if ((post.parent!0)>0)><#return></#if>
    <div class="box clearfix">
        <h4>分支机构</h4>
        <button class="right"><a href="/${this.path}/create.html?parent=${post.ID}">添加</a></button>
        <#local children=post.children>
        <#if children!?has_content>
            <ul>
            <#list children![] as child>
                <li><a href="/${this.path}/show/${child.ID}.shtml">${child.title}</a></li>
            </#list>
            </ul>
        </#if>
    </div>
</#macro>

<#macro show1SlaveFields slave>
	<div>
		<table class="fields">
		    <#local student=slave.student!>
		     <tr><td>孩子信息</td><td><b>${student.nick!}</b> 在 <b>${slave.ageMonthes!0}</b>个月大的时候</td></tr>
		     <tr><td>课程信息</td><td>${slave.classType!}, 时间: ${(slave.coursetime!.now)?datetime}</td></tr>
		     <tr><td>老师</td><td><b>${slave.instructor!}</b></td></tr>
	    </table>

	    <p><b>${slave.title!}--</b> <span class="postcontent">${slave.content!}</span></p>
	    <@authorInfo slave/>
    </div>
</#macro>

<#macro rateDetail post>
    <div class="ratingShow span-11 box" id="rating${post.ID}" style="display:none">
        <@ratingInputUI value=post.affinityRating title="亲和力"/>
        <@ratingInputUI value=post.attractiveRating title="是否能吸引宝宝注意力"/>
        <@ratingInputUI value=post.expressiveRating title="表现力和感染力"/>
        <@ratingInputUI value=post.bridingRating title="各环节衔接性"/>
        <@ratingInputUI value=post.chineseRating title="普通话发音"/>
        <@ratingInputUI value=post.englishRating title="英文发音"/>
    </div>
</#macro>

<#macro filter4SlaveList post>
	<@slavable.filter4SlaveList post;post>
		<li><@searchableSelect name="instructor" title="老师" options=post.instructors! value=searchFilter.of('instructor')/></li>
    	<li><@searchableSelect name="classtype" title="课程" options=post.classTypes! value=searchFilter.of('classtype')/></li>
	</@slavable.filter4SlaveList>	
</#macro>