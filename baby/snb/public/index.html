<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Super Nai Ba</title>
	<link rel="stylesheet" href="res/lungo.css">
	<link rel="stylesheet" href="res/lungo.icon.css">
	<link rel="stylesheet" href="res/lungo.theme.css">
	<style>
	</style>
	<script src="res/quo.js"></script>
	<script src="res/lungo.debug.js"></script>
	<script src="res/mustache.js"></script>
	<script src="res/parse-1.2.8.min.js"></script>
</head>
<body>
	<section id="home" data-transition="slide">
		<header data-title="SNB" data-back="home">
			<nav>
				<a class="on-right" data-icon="user"></a>
			</nav>
		</header>
		<article id="categories" class="list" data-on-load="loadCats()">
			<ul>
				<script type="text/tmpl" id="tmplCate">
				{{#categories}}
				<li class="thumb">
					<img src="{{attributes.thumb}}">
					<div>
						<strong><a data-view-section="category" onclick="loadPosts('{{attributes.name}}')">{{attributes.name}}</a></strong>
						<small>{{attributes.desc}}</small>
					</div>
				</li>
				{{/categories}}
				</script>
			</ul>
		</article>
		<article id="test">
			hello
		</article>
		<footer>
			<nav>
				<a data-icon="favorite" data-view-section="category" href="#">favorite</a>
				<a data-icon="task">task</a>
			</nav>
		</footer>
	</section>
	<section id="category">
		<header data-back="home">
			<nav>
				<a class="on-right" data-icon="user"></a>
			</nav>
		</header>
		<article id="posts">
			<div class="half"></div>
			<ul>
				<script type="text/tmpl" id="tmplPosts">
				{{#posts}}
				<li class="thumb">
					<img src="{{attributes.thumbnail._url}}">
					<strong>{{attributes.title}}</strong>
					<small>{{attributes.excerpt}}</small>
				</li>
				{{/posts}}
				</script>
			</ul>
		</article>
		<footer></footer>
	</section>
	<div id="loading" style="position:absolute;top:0;z-index:999"></div>
	<script type="text/javascript">		
		Parse.initialize("CxZhTKQklDOhDasWX9hidldoK7xtzEmtcl5VSBeL","RwqvvbakVmWPhtO78QCUppfnclzfZ2SyUZ198ArG")
		function loadCats(){
			Lungo.Element.loading("#loading", 1)
			var categories=new Parse.Query(Parse.Object.extend('tag'))
			categories.equalTo("category","category");
			categories.find({
				success:function(cats){
					tmplCate.build({categories:cats})
					Lungo.Element.loading("#loading")
				},
				error: function(){
					Lungo.Article.clear('categories')
					Lungo.Element.loading("#loading");
				}
			})
		}
		function loadPosts(cat){
			Lungo.Element.loading("#loading", 0);
			var posts=new Parse.Query(Parse.Object.extend('post'))
			posts.equalTo("category",cat)
			posts.find({
				success:function(posts){
					Lungo.Element.loading("#loading", 0)
					tmplPosts.build({posts:posts})
				},
				error: function(){
					Lungo.Element.loading("#loading", 0)
					Lungo.Article.clear('posts')
				}
			})
		}
		
		
		Array.prototype.each=function(f){for(var i=0,l=this.length;i<l;i++) f(this[i])}
		
		Lungo.dom("script[type*=tmpl]").each(function(i,tmpl,b){
			this.compiled=Mustache.compile((b=this.innerHTML))
			Mustache.compilePartial(this.id,b)
			this.innerHTML=""
			this.build=function(a){
				Lungo.dom(this.parentNode).append(this.compiled(a))
			}
		})
		
		new Array("load","unload").each(function(e){//support data-on-(un)load	
			Lungo.dom("[data-on-"+e+"]").each(function(i,el){
				(el=Lungo.dom(this)).on(e,new Function('e,a,b,c',el.data('on-'+e)))
			})
		})
		
		Lungo.init({
			name:"SNB",
			history:true
		})
	</script>
 </body>
</html>
