<#macro init>
	<@init_auth/>
</#macro>

<#macro init_auth>
	<#global headMacros=headMacros+["auth_rs"]>
</#macro>

<#macro auth_rs>
<!-- script src="http://api.recaptcha.net/challenge?k=6LfjUNMSAAAAAP2zyt8Wr8kziObpN-g6K6Btj6jY"></script-->
</#macro>

<#macro signupFormExtra></#macro>
<#macro profileFormExtra></#macro>
<#macro afterProfileForm></#macro>

<#macro signin>
    <hr class="space"/>
    <div class="span-6" style="letter-spacing:5px;line-height:25px">
        <p class="quiet">${website.description!}</p>
    </div>
    <div class="article container span-16 last right">
        <div>
        	<span class="large"><b>登录</b></span> <span> 或 <a href="/user/signup.html">注册</a></span>
        	<#if user.isLoggedIn() && user.sinaID!?has_content && !(user.sinaConnected!false)>
        		<b class="right">连接到已经登录的新浪微博帐号</b>
        	</#if>
        </div>
        <hr/>
        <div class="half left border" style="min-height:200px">
            <@weiboAuth/>
        </div>    
    	<div class="half right small" id="signin">
    	    <b>用${website.name}帐号登录:</b>
    		<@signinForm/>
    	</div>
	</div>
</#macro>

<#macro signinForm action="/user/signin.html">
<form action="${action}" method="post">
    <input type="hidden" name="targetURL" value="${targetURL!'/'}">
    <#if error??>
    <div id="msg"><div class="error">${error!}</div></div>
    </#if>
    <table>
        <tr><td>帐号<@required/></td><td><input name="account" value="${accountName!}" required></td></tr>
        <tr><td>密码<@required/></td><td><input type="password" name="password" required> <a href="/user/forgetpassword.html">忘记密码?</a></td></tr>
    </table>
    <div class="actions"><button type="submit">登录</button></div>
</form>
</#macro>

<#macro weiboAuth>
<div>
    <b>用新浪微博帐号登录:</b><hr class="space"/>
    <p>连接你的新浪微博帐户登录到${website.name}.</p>
    <!-- button><a href="/user/weibo/signin"> 新浪微博登录 </a></button-->
    <div id="weibo"></div>
    <@weiboButton/>
</div>
</#macro>

<#macro weiboButton id="weibo" type="6">
	<#if !user.isLoggedIn()>
		<button><a href="/user/weibo/signin.html">新浪微博登录</a></button>
	</#if>
</#macro>

<#macro signup>
	<#local wbConnect=user.isLoggedIn() && user.sinaID!?has_content && !(user.sinaConnected!false)>
    <hr class="space"/>
    <div class="span-6" style="letter-spacing:5px;line-height:25px">
        <p class="quiet">${website.description!}</p>
    </div>
    <div class="article container span-16 last right">
        <div><span class="large"><b>注册</b></span> <span> 或 <a href="/user/signin.html">登录</a></span>
            <#if wbConnect>
        		<b class="right">连接到已经登录的新浪微博帐号</b>
        	</#if>
        </div>
        <hr/>
        <div class="half left border" style="min-height:200px">
            <@weiboAuth/>
        </div>    
        <div class="half right small" id="signup">
            <b>注册${website.name}帐号:</b>
            <@signupForm/>
        </div>
    </div>
</#macro>

<#macro signupForm action="/user/signup.html">
<form action="${action}" method="post">
	<input type="hidden" name="targetURL" value="${targetURL!'/'}">
	<#if error??>
        <div id="msg"><div class="error">${error!}</div></div>
    </#if>
    <table> 
	    <tbody>  
	    <tr><td>帐号<@required/></td><td><input name="account" value="${(input.account)!}" required></td></tr>
		<tr><td>密码<@required/></td><td><input type="password" name="password" required></td></tr>
		<tr><td>密码确认<@required/></td><td><input type="password" name="passwordAgain" required></td></tr>
		<tr><td>Email</td><td><input name="email" value="${(input.email)!}"></td></tr>
		<tr><td>姓名</td><td><input name="name" value="${(input.name)!}"></td></tr>
		<@signupFormExtra/>
        <tr><td></td><td><input name="policy" type="checkbox" value="true" checked="checked">
		    我同意<a href="/page/termofuse.shtml">使用条款</a>和<a href="/page/privacy.shtml">隐私声明</a></td></tr>
		<tbody>
	</table>
	<div class="actions"><button type="submit">注册</button></div>
</form>
</#macro>

<#macro profile>
    <#assign isEditable=true>
    <div id="profile">
        <h3>基本信息</h3>
        <form action="/user/profile.html" method="post"
            onsubmit="return ajaxSubmit.call(this,event)">
            <div id="msg"></div>
            <table>
                 <tr><td>帐号</td><td>${user.account!}</td></tr>
                 <tr><td>Email</td><td><input name="email" value="${user.email!}"/></td></tr>
                 <tr><td>姓名</td><td><input name="name" title="name" value="${user.name!}"/></td></tr>
                 <tr><td>性别</td><td><@radioUI options=["男","女"] name="gender" values=[user.gender!"男"]/></td></tr>
                 <tr><td>生日</td><td><@dateUI name="birthday" minYear=1960 maxYear=2012 value=user.birthday/></td></tr>
                 <@profileFormExtra/>
            </table>
            <div class="actions"><button type="submit">保存</button></div>
        </form>
        <@afterProfileForm/>
    </div>                      
</#macro>

<#macro forgetpassword>
    <div class="article small" id="forgetpassword">
        <h3>重置密码</h3>    
        <form action="/user/forgetpassword"  method="post">
            <table>
                 <tr><td>登录名</td><td><input class="fieldex" name="email" required="true" value="${user.email!}"/></td></tr>
            </table>     
            <div><button type="submit">发给我新密码</button></div>
        </form>
        <script>
            $("#forgetpassword form").submit(function(){
                
            })
        </script>
    </div>
</#macro>

<#macro changepassword>
    <div class="article" id="changepassword">
        <h3>修改密码</h3>
        <form action="/user/changepassword"  method="post">
            <table>
                <tr><td>原密码</td><td><input type="password" name="old"/></td></tr>
                <tr><td>新密码</td><td><input type="password" name="new"/></td></tr>
                <tr><td>密码确认</td><td><input type="password" name="again"/></td></tr>
            </table>
            <div><button type="submit">保存</button></div>
        </form>
        <script>
            $("#changepassword form").submit(function(){
                
            })
        </script>
    </div>
</#macro>

<#macro role>
    <div class="article" id="role">
        <h3>角色管理</h3>
        <form action="/role/save" method="post"
            data-role="ajaxform" 
            data-success="on(data):$('#ID').fieldex('add',data)">
               <h4>
                    <select class="fieldex" name="ID" id="ID" title=" "
                        data-content="/role/list"
                        data-success="on(d):$(this).fieldex('option','entities',d)"
                        onchange="$(this.form).ajaxform('option','entity',$(':selected',this).data('entity'))">
                        <option value="0" class="unremovable">Create Role...</option>
                    </select>
               </h4>
                <table>
                    <tr><td>角色名</td><td><input class="fieldex" name="name"></td></tr>
                    <tr><td>权限列表</td><td><input class="fieldex" type="checkbox" name="capabilities"
                        data-values="js:return entity('/role/allcaps')"/></td></tr>
                    <tr><td>成员</td><td>    
                        <select class="fieldex" name="members" multiple="multiple"
                            data-content="/employee/list"
                            data-success="on(d):$(this).fieldex('option','entities',d)">
                                <option class="unremovable">...</option>
                        </select>
                        </td></tr>
                </table>
                <div><button onclick="remove.call(this.form)">删除</button> <button type="submit">保存</button></div>
        </form>
        <script>
            $("#role form").submit(function(){
                
            })
            function remove(){
                
            }
        </script>
    </div>
</#macro>

<#macro weiboconnect>
	<style>
		#wbconnect .current{font-size:large}
	</style>
    <hr class="space"/>
    <div class="span-6" style="letter-spacing:5px;line-height:25px">
        <p class="quiet">${website.description!}</p>
    </div>
    <div class="article container span-16 last right">
        <div><span class="large"><b>注册</b></span> <span> 或 <a href="/user/signin.html">登录</a></span></div>
        <hr/>
        <div class="half left border" style="min-height:200px">
            <div>
                <b>连接新浪微博帐号:</b><hr class="space"/>
                <p>连接你的新浪微博帐户到${website.name}后,就可以.</p>
                <div id="weibo"></div>
                <@weiboButton/>
            </div>
        </div>    
        <div class="half right small" id="wbconnect">
            <b>
                <a href="Javascript:void(0)" class="current" onclick="$('#signup').hide().removeClass('current');$('#signin').show('slow').addClass('current')">关联已有账号</a> 或者 
                <a href="Javascript:void(0)" onclick="$('#signin').hide().removeClass('current');$('#signup').show('slow').addClass('current')">注册${website.name}帐号并关联</a>
            </b>
            <div id="signin"><@signinForm action="/user/weibo/connect"/></div>
            <div id="signup" style="display:none"><@signupForm action="/user/weibo/connect/create"/></div>
        </div>
    </div>
</#macro>

<#macro activation_email>
Thank you registrate on ${website.name}, please go to your email inbox, and activate your account.
</#macro>

<#macro activation_complete>
<div class="box">
Congratulations! You have activated your account. Have fun with ${website.name}. It will direct you to home page in 5 seconds.
<script>setTimeout("document.location='/'",5000)</script>
</div>
</#macro>

<#macro activation_failed>
Sorry! the activation key has expired, please signup again.
</#macro>

<#macro registration_complete>
Congratulations! You have registrated your account. Have fun with ${website.name}.
</#macro>


<#macro showToken>
token=${token}
</#macro>