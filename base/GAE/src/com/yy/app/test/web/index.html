<#macro init>
    <#assign headMacros=headMacros+['test_rs']>
</#macro>


<#macro test_rs>
    <style>
        #reslist td{word-wrap:break-word;overflow:hidden}
        #reslist input.cond{width:5em}
        #reslist button{width:5em;font-size:small}
        .false{background-color:#FBE3E4}
        .true{background-color:#00FF7F}
        #reslist dd{max-height: 3em;overflow-y: scroll}
    </style>
</#macro>

<#macro show>
<h4> <a href="/test"><span id="a"></span>${resources?size} Testable Resources</a> 
    <div class="right">
        <button onclick="$('tr').show();$('#a').text('')">Show All</button>
        <button onclick="$('#a').text($('tr').hide().filter('.GET').show().length+'/')">GET</button>
        <button onclick="$('#a').text($('tr').hide().filter('.POST').show().length+'/')">POST</button>
        <#if test??>
        <button onclick="$('tr').hide();$('#a').text($('dt.true').parents('tr').show().prev().show().length+'/')">Successed</button>
        <button onclick="$('tr').hide();$('#a').text($('dt.false').parents('tr').show().prev().show().length+'/')">Failed</button>
        </#if>
      </div>
      <form class="right" method="post"><button type="submit">Test All</button></form></h4>
<div class="span-24"> 
<table id="reslist" style="border:1px solid #bbb;width:100%;">
    <thead>
        <tr><th><input type="checkbox" onclick="var c=this.checked;$('input[type=checkbox]').each(function(){this.checked=c})"></th>
            <th>root</th><th>http</th><th>sub</th><th>function</th></tr></thead>
    <tbody>        
    <#local last="", index=0, testCaseCounter=0, failCounter=0, successCounter=0 >
    <#list resources as am>
        <#local wm=viewer.getWebMethod(am) current=wm.root, sub=wm.sub>
         <tr class="${wm.httpMethod}"><td><input type="checkbox" value="${index}"></td>
            <td>
                <#if current!=last>
                    <#local last=current>
                    ${current}
                <#else>
                    &nbsp;
                </#if>
                </td><td>
                    <button><a href="/test/${index}" target="tester">${wm.httpMethod}</a></button></td><td>${wm.inputSub}
                    </td><td>${wm.simpleMethod()}</td></tr>
              <#if test??>
                <#flush>
                <tr><td colspan="5">
                    <#local results=wm.execute()>
                    <dl class="results">
                        <#list results as result>
                            <#local testCaseCounter=testCaseCounter+1>
                            <#if result.success><#local successCounter=successCounter+1></#if>
                            <#local failCounter=testCaseCounter-successCounter>
                            <dt class="${result.success?string}">${testCaseCounter} : ${result.url}</dt>
                            <dd class="${result.success?string}">${result.message!?html}</dd>
                        </#list>
                    </dl>
                </td></tr>
              </#if>
         <#local index=index+1>
    </#list>
    </tbody>
</table>
<div> ${testCaseCounter} test cases, ${successCounter} success, ${failCounter} failed</div>
</div>
<#local a=viewer.clean()>
</#macro>


<#macro test1>
    <h5>${resource.root}/${resource.sub} <button class="right"><a href="/test">Back To Test Management</a></button></h5>
     <dl class="results">
        <#list results as result>
            <dt class="${result.success?string}">${resource.httpMethod} <a href="${result.url}" target="tester2">${result.url}</a></dt>
            <dd class="${result.success?string}">${result.message!?html}</dd>
        </#list>
     </dl>
     <#local a=viewer.clean()>
</#macro>